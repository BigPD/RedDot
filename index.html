
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Red Dot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBf_-GczUpJhZFniZ9teSrCuLeAOU6wZNY",
      authDomain: "reddot-890a5.firebaseapp.com",
      projectId: "reddot-890a5",
      storageBucket: "reddot-890a5.firebasestorage.app",
      messagingSenderId: "28831632277",
      appId: "1:28831632277:web:e20a9ab5d1b5037778049c",
      measurementId: "G-E66NZ5B56L"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.firebase = { db, collection, addDoc, query, orderBy, limit, getDocs };
  </script>

  <style>
    body { font-family: sans-serif; text-align: center; background: #f0f0f0; margin: 0; }
    h1 { margin: 20px; }
    #game { position: relative; width: 100%; height: 60vh; background: #fff; overflow: hidden; margin-bottom: 20px; }
    .circle { width: 50px; height: 50px; border-radius: 50%; background: red; position: absolute; cursor: pointer; }
    #score, #timer { font-size: 24px; margin: 10px; }
    #start-dot {
      width: 100px; height: 100px; border-radius: 50%;
      background: red; margin: 50px auto;
      color: white; font-size: 24px; display: flex;
      align-items: center; justify-content: center;
      cursor: pointer;
    }
    #play-again {
      display: none; padding: 10px 20px; font-size: 18px;
      margin-top: 10px; background: red; color: white;
      border: none; border-radius: 8px; cursor: pointer;
    }
    .ad-banner { width: 100%; height: 90px; background: #ccc; margin-top: 10px; line-height: 90px; }
    .leaderboards { display: flex; justify-content: center; gap: 40px; flex-wrap: wrap; margin-top: 20px; }
    table { margin: 0 auto; border-collapse: collapse; }
    th, td { border: 1px solid #333; padding: 8px 16px; background: #fff; }
  </style>
</head>
<body>
<h1>Red Dot</h1>
<div class="ad-banner">Ad Banner Placeholder</div>
<div id="score">Score: 0</div>
<div id="timer">Time: 30s</div>
<div id="game"></div>
<div id="start-dot" onclick="startCountdown()">Start</div>
<button id="play-again">Play Again</button>
<div class="ad-banner">Ad Banner Placeholder</div>

<div class="leaderboards">
  <div>
    <h3>üèÜ All-Time Leaderboard</h3>
    <div id="leaderboard-all"></div>
  </div>
  <div>
    <h3>üìÖ Daily Leaderboard</h3>
    <div id="leaderboard-daily"></div>
  </div>
</div>

<script>
  let score = 0, time = 30, timer = null;
  const game = document.getElementById('game');
  const scoreDisplay = document.getElementById('score');
  const timerDisplay = document.getElementById('timer');
  const startDot = document.getElementById('start-dot');
  const playAgainBtn = document.getElementById('play-again');

  const todayKey = new Date().toISOString().split('T')[0];

  function spawnCircle() {
    const circle = document.createElement('div');
    circle.className = 'circle';
    circle.style.top = Math.random() * (game.clientHeight - 50) + 'px';
    circle.style.left = Math.random() * (game.clientWidth - 50) + 'px';
    circle.onclick = () => {
      score++;
      scoreDisplay.textContent = 'Score: ' + score;
      circle.remove();
      spawnCircle();
    };
    game.appendChild(circle);
  }

  function startGame() {
    score = 0;
    time = 30;
    scoreDisplay.textContent = 'Score: 0';
    timerDisplay.textContent = 'Time: 30s';
    game.innerHTML = '';
    spawnCircle();
    timer = setInterval(() => {
      time--;
      timerDisplay.textContent = 'Time: ' + time + 's';
      if (time <= 0) {
        clearInterval(timer);
        endGame();
      }
    }, 1000);
  }

  function startCountdown() {
    startDot.style.display = 'none';
    startGame();
  }

  playAgainBtn.onclick = () => {
    playAgainBtn.style.display = 'none';
    startDot.style.display = 'flex';
  };

  async function endGame() {
    game.innerHTML = '';
    playAgainBtn.style.display = 'inline-block';
    let name = prompt("Game Over! Enter your name:");
    if (!name) return;

    const entry = { name: name.substring(0, 15), score, timestamp: new Date().toISOString() };
    const { db, collection, addDoc } = window.firebase;

    await addDoc(collection(db, "leaderboard_all"), entry);
    await addDoc(collection(db, "leaderboard_daily_" + todayKey), entry);

    updateLeaderboards();
  }

  async function updateLeaderboards() {
    const { db, collection, query, orderBy, limit, getDocs } = window.firebase;

    const fetchTop = async (col, divId) => {
      const q = query(collection(db, col), orderBy("score", "desc"), limit(10));
      const snap = await getDocs(q);
      const rows = [];
      snap.forEach((doc, idx) => {
        const d = doc.data();
        rows.push(`<tr><td>${idx + 1}</td><td>${d.name}</td><td>${d.score}</td></tr>`);
      });
      document.getElementById(divId).innerHTML =
        '<table><tr><th>Rank</th><th>Name</th><th>Score</th></tr>' + rows.join('') + '</table>';
    };

    await fetchTop("leaderboard_all", "leaderboard-all");
    await fetchTop("leaderboard_daily_" + todayKey, "leaderboard-daily");
  }

  window.addEventListener("load", updateLeaderboards);
</script>
</body>
</html>
